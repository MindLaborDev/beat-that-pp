(()=>{var t={21:t=>{function e(t,e=2){return~~(t*Math.pow(10,e))/Math.pow(10,e)}function a(t){if(0==t)return"0 Byte";var a=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return e(t/Math.pow(1024,a))+" "+["Bytes","KB","MB","GB","TB"][a]}let s=!1;class r{static songs=[];static rankedSongs=[];static async getPlayerId(t){const e=`https://new.scoresaber.com/api/players/by-name/${t}`,a=await r.get(e);return a?1!==a.players.length?-2:a.players[0].playerId:-1}static async getPlayerData(t){const e=`https://new.scoresaber.com/api/player/${t}/full`,a=await r.get(e);return Object.assign(a.playerInfo,a.scoreStats)}static async getScores(t,e){const a=`https://new.scoresaber.com/api/player/${t}/scores/top/${e}`;return(await r.get(a)).scores}static async getSongData(t,e){if(r.songs[t])return r.songs[t];const a=`https://beatsaver.com/api/maps/by-hash/${t}`,s=await r.get(a);if(s.metadata.characteristics=s.metadata.characteristics.filter((t=>"Standard"===t.name)),!s.metadata.characteristics.length)return;const n=s.metadata.characteristics[0].difficulties[difficultiesMap[e]];return n?Object.assign(n,{cover:`https://beatsaver.com${s.coverURL}`,description:s.description,zip:`https://beatsaver.com${s.directDownload}`,key:s.key,name:s.name,heat:s.stats.heat,downloads:s.stats.downloads,difficulty:difficultiesMap[e]}):void 0}static async getMapDetails(t,e=!0){const a=`https://beatsaver.com/api/maps/detail/${t}`,s=await r.get(a);if(404!==s){if(e){const t=await r.get(`https://deep-beat.000webhostapp.com/?hash=${s.hash}`);s._diffs=JSON.parse(t)}return s}}static async getCoverBlob(t){const e=t.file("info.dat")||t.file("Info.dat"),a=await e.async("string");return JSON.parse(a),blob}static getAudioBlob(t,e=!1){return new Promise((async a=>{const s=new Audio;if(s.volume=.2,e);else{const e=t.file("info.dat")||t.file("Info.dat"),r=await e.async("string"),n=JSON.parse(r),o=n._songFilename,i=await t.file(o).async("blob"),c=n._coverImageFilename,l=await t.file(c).async("blob");s.src=URL.createObjectURL(i),s.currentTime=n._previewStartTime,s.onloadedmetadata=function(){a({audio:s,cover:l})}}}))}static async downloadMap(t){t.endsWith(".audica")&&(t=`https://bsaber-cors-anywhere.herokuapp.com/${t}`);const e=await fetch(t),s=a(e.headers.get("content-length"));if(console.log(s),200!=e.status)return;const r=new JSZip;return await r.loadAsync(e.blob())}static get(t){return new Promise((e=>{try{$.ajax({url:t,type:"get",success:async function(t,a){if("success"!==a)return console.error(a),void e({error:a});e(t)},error:t=>e(t.status)})}catch{e()}}))}}t.exports={clean:function(t){return`${t}`.replace(/<[^>]+>/g,"")},round:e,bytesToSize:a,convertDate:function(t){const e=new Date(t);return e.getDate()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]+" "+e.getFullYear()},preview:function(t){const e=$("#preview-map");e.find("> iframe").attr("src",`https://skystudioapps.com/bs-viewer/?id=${t}`),s=!0,setTimeout((()=>{s&&e.removeClass("u-none")}),1500)},API:r}}},e={};function a(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,a),n.exports}(()=>{"use strict";const{API:t}=a(21);async function e(e){$("#error-msg").addClass("u-none");let a=e.val().trim();if(a=a.replace(/!bsr\s*/g,""),a=a.replace(/https?:\/\//g,""),a=a.replace(/beatsaver.com\/beatmap\//g,""),a){if(e.removeClass("text-danger input-error"),null==await t.getMapDetails(a,!1))return e.addClass("text-danger input-error"),void $("#error-msg").text("I couldn't find that map!").removeClass("u-none");window.location.href="/map#"+a}else e.addClass("text-danger input-error")}$(document).ready((function(){const t=$("#key");t.on("input",(()=>{t.removeClass("text-danger input-error")})),$("#generate-song-report").click((()=>e(t))),t.on("keyup",(a=>{"Enter"===a.key&&e(t)})),$("#upload-file").click((()=>{window.location.href="/map#upload"}))}))})()})();
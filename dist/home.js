(()=>{var t={21:t=>{function e(t,e=2){return~~(t*Math.pow(10,e))/Math.pow(10,e)}function a(t){if(0==t)return"0 Byte";var a=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return e(t/Math.pow(1024,a))+" "+["Bytes","KB","MB","GB","TB"][a]}let r=!1;class s{static songs=[];static rankedSongs=[];static async getPlayerId(t){const e=`https://new.scoresaber.com/api/players/by-name/${t}`,a=await s.get(e);return a?1!==a.players.length?-2:a.players[0].playerId:-1}static async getPlayerData(t){const e=`https://new.scoresaber.com/api/player/${t}/full`,a=await s.get(e);return Object.assign(a.playerInfo,a.scoreStats)}static async getScores(t,e){const a=`https://new.scoresaber.com/api/player/${t}/scores/top/${e}`;return(await s.get(a)).scores}static async getSongData(t,e){if(s.songs[t])return s.songs[t];const a=`https://beatsaver.com/api/maps/by-hash/${t}`,r=await s.get(a);if(r.metadata.characteristics=r.metadata.characteristics.filter((t=>"Standard"===t.name)),!r.metadata.characteristics.length)return;const n=r.metadata.characteristics[0].difficulties[difficultiesMap[e]];return n?Object.assign(n,{cover:`https://beatsaver.com${r.coverURL}`,description:r.description,zip:`https://beatsaver.com${r.directDownload}`,key:r.key,name:r.name,heat:r.stats.heat,downloads:r.stats.downloads,difficulty:difficultiesMap[e]}):void 0}static async getMapDetails(t,e=!0){const a=`https://beatsaver.com/api/maps/detail/${t}`,r=await s.get(a);if(404!==r){if(e){const t=await s.get(`https://deep-beat.000webhostapp.com/?hash=${r.hash}`);r._diffs=JSON.parse(t)}return r}}static getAudioBlob(t,e=!1){return new Promise((async a=>{const r=new Audio;if(r.volume=.2,e){const e=await t.file("song.desc").async("string"),s=JSON.parse(e),n=s.moggSong.substring(0,s.moggSong.length-4),o=await t.file(n).async("uint8array");let i=Array.from(o.slice(4,8));i=(i=i.map((t=>{let e=t.toString(16);return 1==e.length&&(e="0"+e),e}))).reverse(),i=parseInt(i.join(""),16);const c=o.slice(i,o.size),l=new Blob([c],{type:"application/ogg"});r.src=URL.createObjectURL(l),r.currentTime=s.previewStartSeconds,r.onloadedmetadata=function(){a(r)}}else{const e=t.file("info.dat")||t.file("Info.dat"),s=await e.async("string"),n=JSON.parse(s),o=n._songFilename,i=await t.file(o).async("blob");r.src=URL.createObjectURL(i),r.currentTime=n._previewStartTime,r.onloadedmetadata=function(){a(r)}}}))}static async downloadMap(t){t.endsWith(".audica")&&(t=`https://bsaber-cors-anywhere.herokuapp.com/${t}`);const e=await fetch(t),r=a(e.headers.get("content-length"));if(console.log(r),200!=e.status)return;const s=new JSZip;return await s.loadAsync(e.blob())}static get(t){return new Promise((e=>{try{$.ajax({url:t,type:"get",success:async function(t,a){if("success"!==a)return console.error(a),void e({error:a});e(t)},error:t=>e(t.status)})}catch{e()}}))}}t.exports={clean:function(t){return`${t}`.replace(/<[^>]+>/g,"")},round:e,bytesToSize:a,convertDate:function(t){const e=new Date(t);return e.getDate()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]+" "+e.getFullYear()},preview:function(t){const e=$("#preview-map");e.find("> iframe").attr("src",`https://skystudioapps.com/bs-viewer/?id=${t}`),r=!0,setTimeout((()=>{r&&e.removeClass("u-none")}),1500)},API:s}}},e={};function a(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,a),n.exports}(()=>{"use strict";const{API:t}=a(21);$(document).ready((function(){const e=$("#key");e.on("input",(()=>{e.removeClass("text-danger input-error")})),$("#generate-song-report").click((async function(){$("#error-msg").addClass("u-none");let a=e.val().trim();if(a=a.replace(/!bsr\s*/g,""),a=a.replace(/https?:\/\//g,""),a=a.replace(/beatsaver.com\/beatmap\//g,""),a){if(e.removeClass("text-danger input-error"),null==await t.getMapDetails(a,!1))return e.addClass("text-danger input-error"),void $("#error-msg").text("I couldn't find that map!").removeClass("u-none");window.location.href="/map#"+a}else e.addClass("text-danger input-error")}))}))})()})();